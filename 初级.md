# 01-初级

- [常用术语](#常用术语)
- [执行顺序](#执行顺序)
- [检索数据](#检索数据)
  - [select语句](#select语句：选择列)
  - [limit语句](#limit语句：限制行数)
- [排序数据](#排序数据)
  - [order by语句](#order by语句：排序)
- [过滤数据](#过滤数据)
  - [where语句](#where语句：增加过滤条件)
  - [常用操作符](#where语句常用操作符)
- [创建计算字段](#创建计算字段)
  - [拼接字段](#拼接字段)
  - [算术计算](#算术计算)
  - [条件计算](#条件计算)
- [汇总数据](#汇总数据)
  - [聚合函数](#聚合函数)
  - [group by语句](#group by语句：数据分组)
  - [having语句](#having语句：过滤分组)
- [子查询](#子查询)
- 联结表

<br/>

## 常用术语

- **SQL**（Structured Query Language）：是一种专用们来与数据库沟通的语言。
- **数据库**（database）：是 一个以某种有组织的方式存储的数据集合，就像是一个存放数据的文件柜。
- **数据表**（table）： 文件柜中存放的资料，是某种特定类型数据的结构化清单。
- **列**（column）：数据表中的字段，所有表都由一个或多个列组成。
- **行**（row）：表中的一行记录。
- **主键**（primary key）：一列（或一组列），其值能够唯一标识表中每一行。主键是唯一的。

<br/>

------

## 执行顺序

1. FROM
2. WHERE
3. GROUP BY
4. HAVING
5. SELECT
6. DISTINCT
7. UNION
8. ORDER BY

> **注意：**
>
> - FROM是SQL语句执行的第一步，并非SELECT，数据库在执行SQL语句的第一步是将数据从硬盘加载到数据缓冲区中，以便对这些数据进行操作；
> - SELECT 是在FROM和GROUP BY之后执行。这就是不能在WHERE中使用在SELECT中设定别名的字段作为判断条件的原因；
> - 无论在语法上还是在执行顺序上， UNION总是排在在ORDER BY之前。

<br/>

------

## 检索数据

### select语句：选择列

```mysql
# 检索所有的列
select *
from tablename;

# 检索多个列
select id, name
from tablename;

# 检索不同的值
select distinct id
from tablename;
```

<br/>

### limit语句：限制行数

```mysql
# 限制前100行数据
select *
from tablename
limit 100;

# 返回第5行(不含)之后的100行数据
select *
from tablename
limit 100 offset 5;
```

<br/>

------

## 排序检索

### order by语句：排序

- order by默认升序：asc；降序为：desc 

```mysql
# 默认升序
select apply_date, name
from tablename
order by apply_date;

# 多列排序：apply_date升序，name降序
select apply_date, name
from tablename
order by apply_date, name desc;

# 按位置排序：第1列升序，第2列降序
select apply_date, name
from tablename
order by 1, 2 desc;
```

<br/>

------

## 过滤数据

### where语句：增加过滤条件

```mysql
select *
from tablename
where apply_date = '2021-01-21';
```

<br/>

### where语句常用操作符

- 条件查询：=,  <>,  !=,  >,  <（`其中不等于符号<>是标准语法，适用范围比!=广`）

```mysql
select *
from tablename
where apply_date <> '2021-01-21';

select *
from tablename
where apply_date >= '2021-01-21';
```

- 范围查询：in, between

```mysql
# 文本值范围
select *
from tablename
where grade in ('A','B');

# 数值范围（包含范围两端）
select *
from tablename
where age between 2 and 10;
```

- 空值查询：is (not) null

```mysql
select *
from tablename
where name is (not) null;
```

- 模糊查询："like"与''%''结合（如果用Python读取SQL语句，需要将%改为%%）

```mysql
# 开头模糊
select *
from tablename
where name like '%ing';

# 末尾模糊
select *
from tablename
where name like 'Fish%';

# 两端模糊
select *
from tablename
where name like '%is%';
```

- 多条件查询：and，or（`在处理or操作符之前，优先处理and操作符，使用圆括号明确分组！`）

```mysql
select *
from tablename
where grade in ('A','B')
and apply_date >= '2021-01-21';
```

<br/>

------

## 创建计算字段

### 拼接字段

```mysql
select concat(id, '-', name) as new_col
from tablename;
```

### 算术计算

- 常用算数符号：+,  -,  *,  /

```mysql
select period * amount as new_col
from tablename;
```

### 条件计算

- if( [expr], [result1], [result2] )
- case when [expr] then [result1] else [result2] end

```mysql
select 
 apply_date
,if(state=1,'approve','reject') as state1
,case state
 when 1 then 'approve'
 when 2 then 'reject'
 else 'other'
 end as state2
,case when state = 1 then 'approve'
 	  when state = 2 then 'reject'
 	  else 'other' end as state3
from tablename;
```

<br/>

------

## 汇总数据

### 聚合函数

- 常用聚合函数sum( ),  count(),  count(distinct ),  avg(),  max(),  min()

```mysql
select
 cont(distinct *) `总行数`
,count(id) `总人数`
,sum(amount) `总金额`
,avg(amount) `平均金额`
from tablename;
```

<br/>

### group by语句：数据分组

```mysql
select 
 date_format(apply_time,'%Y-%m') `月份`
,count(id) `总人数`
from tablename
group by 1
order by 1;
```

<br/>

### having语句：过滤分组

```mysql
select 
 date_format(apply_time,'%Y-%m') `月份`
,count(id) `总人数`
from tablename
group by 1
having count(id) >= 30
order by 1;
```

<br/>

------

## 子查询

### 子查询作为过滤数据条件

```mysql
# 仅限单列
select *
from tablename1
where id in
            (
            select id
            from tablename2
            where grade = 'A'
            );
```

<br/>

### 子查询作为汇总数据前提

```mysql
select id, avg(amount)
from 
    (
    select id, amount
    from tablename
    where grade = 'A'
    )
group by 1;
```

<br/>

### 子查询作为计算字段

```mysql
select 
 id
,(select count(*)
  from tablename2
  where tablename2.id = tablename1.id) as cnt
from tablename1;
```

<br/>

## 联结表

### union语句 纵列关联，并且列名称要都相同

- union主要用于两张表的上下关联，如果遇有一样的同一行数据，则自动去重

```mysql
select 'M1' as overdue_type union
select 'M2' as overdue_type union
select 'M3' as overdue_type union
select 'M3+' as overdue_type 
```

- union all主要用于两张表的上下关联，如果遇有一样的同一行数据，不会去重

```mysql
select 'M1' as overdue_type union all
select 'M2' as overdue_type union all
select 'M3' as overdue_type union all
select 'M3' as overdue_type union all
select 'M3+' as overdue_type 
```

<br/>

### 横向表连接

**left join（左关联）**： 获取左表所有记录，即使右表没有对应匹配的记录。用的比较多 .

 ![img](https://www.runoob.com/wp-content/uploads/2014/03/img_leftjoin.gif) 

**right join（右关联）**： 与 LEFT JOIN 相反，用于获取右表所有记录，即使左表没有对应匹配的记录 

 ![img](https://www.runoob.com/wp-content/uploads/2014/03/img_rightjoin.gif) 

**inner join（内关联）**： 取交集，获取两个表中字段匹配关系的记录 。主要用于共债查询。

 ![img](https://www.runoob.com/wp-content/uploads/2014/03/img_innerjoin.gif) 

**full join（全关联）**：取并集。主要用于Lagged

```mysql
select 
 odr.id
,odr.user_name
,odr.shop_id
,channel.channel_code
,channel.channel_desc
from tablename odr
left join shop channel on  odr.channel_id=channel.id;
```

<br/>

#### 等值联接  等值连接一般把条件放在where里面 使用等号“=”连接相关的表

```MySQL
select 
 debit.id  debit_id
,debit.shop_id
,shop.id shop_id_new
,shop.name
from 
 tablename debit
,shop shop
where date(apply_time)=date(now())
and shop.id=debit.shop_id
```


